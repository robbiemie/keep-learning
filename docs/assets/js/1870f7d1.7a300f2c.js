"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[2141],{5668:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"web/vue/vue3/ref","title":"ref","description":"\u5728 Vue 3 \u7684 Composition API \u4e2d\uff0cref \u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u51fd\u6570\uff0c\u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u54cd\u5e94\u5f0f\u7684\u5f15\u7528\u5bf9\u8c61\u3002\u8fd9\u4e2a\u5f15\u7528\u5bf9\u8c61\u53ef\u4ee5\u5305\u88f9\u4efb\u4f55\u7c7b\u578b\u7684\u503c\uff0c\u5305\u62ec\u57fa\u672c\u7c7b\u578b\uff08\u5982 String\u3001Number\uff09\u6216\u5bf9\u8c61\u7c7b\u578b\u3002\u4f7f\u7528 ref \u521b\u5efa\u7684\u54cd\u5e94\u5f0f\u6570\u636e\uff0cVue \u4f1a\u81ea\u52a8\u8ddf\u8e2a\u5b83\u4eec\u7684\u53d8\u5316\uff0c\u5e76\u5728\u53d8\u5316\u65f6\u66f4\u65b0\u89c6\u56fe\u3002\u8fd9\u4e3a\u5728 Vue 3 \u4e2d\u7ba1\u7406\u72b6\u6001\u63d0\u4f9b\u4e86\u6781\u5927\u7684\u7075\u6d3b\u6027\u548c\u4fbf\u5229\u3002","source":"@site/markdown/web/11.vue/vue3/07.ref.md","sourceDirName":"web/11.vue/vue3","slug":"/web/vue/vue3/ref","permalink":"/keep-learning/docs/web/vue/vue3/ref","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u4f9d\u8d56\u6536\u96c6","permalink":"/keep-learning/docs/web/vue/vue3/\u4f9d\u8d56\u6536\u96c6"},"next":{"title":"scheduler","permalink":"/keep-learning/docs/web/vue/vue3/scheduler"}}');var a=r(4848),t=r(8453);const i={},s="ref",c={},o=[{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:2},{value:"\u4e3a\u4ec0\u4e48 ref \u8981\u8bbe\u8ba1\u6210\u901a\u8fc7 .value \u8bbf\u95ee\u5462",id:"\u4e3a\u4ec0\u4e48-ref-\u8981\u8bbe\u8ba1\u6210\u901a\u8fc7-value-\u8bbf\u95ee\u5462",level:2},{value:"ref \u4e0e reactive \u7684\u533a\u522b",id:"ref-\u4e0e-reactive-\u7684\u533a\u522b",level:2},{value:"\u6e90\u7801\u793a\u4f8b",id:"\u6e90\u7801\u793a\u4f8b",level:2}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"ref",children:"ref"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\u5728 Vue 3 \u7684 Composition API \u4e2d\uff0cref \u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u51fd\u6570\uff0c\u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u54cd\u5e94\u5f0f\u7684\u5f15\u7528\u5bf9\u8c61\u3002\u8fd9\u4e2a\u5f15\u7528\u5bf9\u8c61\u53ef\u4ee5\u5305\u88f9\u4efb\u4f55\u7c7b\u578b\u7684\u503c\uff0c\u5305\u62ec\u57fa\u672c\u7c7b\u578b\uff08\u5982 String\u3001Number\uff09\u6216\u5bf9\u8c61\u7c7b\u578b\u3002\u4f7f\u7528 ref \u521b\u5efa\u7684\u54cd\u5e94\u5f0f\u6570\u636e\uff0cVue \u4f1a\u81ea\u52a8\u8ddf\u8e2a\u5b83\u4eec\u7684\u53d8\u5316\uff0c\u5e76\u5728\u53d8\u5316\u65f6\u66f4\u65b0\u89c6\u56fe\u3002\u8fd9\u4e3a\u5728 Vue 3 \u4e2d\u7ba1\u7406\u72b6\u6001\u63d0\u4f9b\u4e86\u6781\u5927\u7684\u7075\u6d3b\u6027\u548c\u4fbf\u5229\u3002"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u57fa\u672c\u7528\u6cd5",children:"\u57fa\u672c\u7528\u6cd5"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"import { ref } from 'vue';\n\nconst count = ref(0); // \u521b\u5efa\u4e00\u4e2a\u54cd\u5e94\u5f0f\u7684\u5f15\u7528\uff0c\u521d\u59cb\u503c\u4e3a 0\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u6a21\u677f\u4e2d\u76f4\u63a5\u4f7f\u7528\u65f6\uff0cVue \u4f1a\u81ea\u52a8\u89e3\u5305 ref \u5bf9\u8c61"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"<template>\n  <div>{{ count }}</div> \x3c!-- Vue \u81ea\u52a8\u89e3\u5305 `count` \u7684\u503c --\x3e\n</template>\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728 JavaScript \u4e2d\u8bbf\u95ee\u6216\u4fee\u6539 ref \u521b\u5efa\u7684\u54cd\u5e94\u5f0f\u5f15\u7528\u7684\u503c\u65f6\uff0c\u9700\u8981\u901a\u8fc7 .value \u5c5e\u6027\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"console.log(count.value); // \u8bfb\u53d6 `count` \u7684\u503c\ncount.value++; // \u4fee\u6539 `count` \u7684\u503c\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u4e3a\u4ec0\u4e48-ref-\u8981\u8bbe\u8ba1\u6210\u901a\u8fc7-value-\u8bbf\u95ee\u5462",children:"\u4e3a\u4ec0\u4e48 ref \u8981\u8bbe\u8ba1\u6210\u901a\u8fc7 .value \u8bbf\u95ee\u5462"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"\u7edf\u4e00\u57fa\u672c\u7c7b\u578b\u548c\u5f15\u7528\u7c7b\u578b\u7684\u54cd\u5e94\u5f0f\u5305\u88c5"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Vue 3 \u7684\u54cd\u5e94\u5f0f\u7cfb\u7edf\u4f7f\u7528 Proxy \u6765\u5b9e\u73b0\uff0c\u800c Proxy \u53ef\u4ee5\u4ee3\u7406\u5bf9\u8c61\uff0c\u4f46\u4e0d\u80fd\u76f4\u63a5\u4ee3\u7406\u57fa\u672c\u7c7b\u578b\uff08\u5982\u5b57\u7b26\u4e32\u3001\u6570\u5b57\u7b49\uff09\u3002\u4e3a\u4e86\u8ba9\u57fa\u672c\u7c7b\u578b\u4e5f\u80fd\u4eab\u6709\u54cd\u5e94\u5f0f\u7684\u7279\u6027\uff0cVue \u901a\u8fc7 ref \u63d0\u4f9b\u4e00\u4e2a\u5bf9\u8c61\u5305\u88c5\u5668\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u6709\u4e00\u4e2a .value \u5c5e\u6027\u6307\u5411\u5b9e\u9645\u7684\u6570\u636e\u3002\u8fd9\u6837\uff0c\u65e0\u8bba\u662f\u57fa\u672c\u7c7b\u578b\u8fd8\u662f\u5f15\u7528\u7c7b\u578b\uff0c\u90fd\u53ef\u4ee5\u7edf\u4e00\u901a\u8fc7 .value \u6765\u8bbf\u95ee\u548c\u4fee\u6539\uff0c\u4f7f\u5f97 Vue \u7684\u54cd\u5e94\u5f0f\u7cfb\u7edf\u66f4\u52a0\u7075\u6d3b\u548c\u901a\u7528\u3002"}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"\u4fdd\u6301\u54cd\u5e94\u5f0f\u5f15\u7528\u7684\u4e00\u81f4\u6027"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u5728 Vue 3 \u4e2d\uff0c\u4f7f\u7528 ref \u548c reactive \u90fd\u53ef\u4ee5\u521b\u5efa\u54cd\u5e94\u5f0f\u6570\u636e\uff0c\u4f46\u5b83\u4eec\u7684\u4f7f\u7528\u573a\u666f\u548c\u76ee\u7684\u6709\u6240\u4e0d\u540c\u3002ref \u4e3b\u8981\u7528\u4e8e\u57fa\u672c\u7c7b\u578b\u548c\u9700\u8981\u88ab\u5305\u88c5\u4e3a\u54cd\u5e94\u5f0f\u7684\u5355\u4e00\u503c\uff0c\u800c reactive \u7528\u4e8e\u5bf9\u8c61\u548c\u6570\u7ec4\u3002\u901a\u8fc7\u8981\u6c42\u8bbf\u95ee .value\uff0cref \u4fdd\u6301\u4e86\u5bf9\u6240\u6709\u7c7b\u578b\u503c\u7684\u4e00\u81f4\u8bbf\u95ee\u65b9\u5f0f\uff0c\u65e0\u8bba\u5b83\u4eec\u662f\u5426\u88ab reactive \u5904\u7406\u3002\u8fd9\u79cd\u8bbe\u8ba1\u7b80\u5316\u4e86 API \u5e76\u51cf\u5c11\u4e86\u4f7f\u7528\u4e0a\u7684\u6df7\u6dc6\u3002"}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:"\u81ea\u52a8\u89e3\u5305\u5728\u6a21\u677f\u4e2d\u7684\u4fbf\u5229\u6027"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u867d\u7136\u5728 JavaScript \u4e2d\u9700\u8981\u901a\u8fc7 .value \u6765\u8bbf\u95ee ref \u5305\u88c5\u7684\u6570\u636e\uff0cVue 3 \u7684\u6a21\u677f\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u89e3\u5305\u6a21\u677f\u4e2d\u7684 ref\uff0c\u4f7f\u5f97\u5728\u6a21\u677f\u4e2d\u4f7f\u7528\u65f6\u65e0\u9700\u6307\u5b9a .value\u3002\u8fd9\u79cd\u81ea\u52a8\u89e3\u5305\u7684\u7279\u6027\u63d0\u4f9b\u4e86\u6a21\u677f\u8868\u8fbe\u5f0f\u7684\u4fbf\u5229\u6027\uff0c\u540c\u65f6\u4fdd\u7559\u4e86\u5728 JavaScript \u4e2d\u663e\u5f0f\u8bbf\u95ee\u63a7\u5236\u7684\u80fd\u529b\u3002"}),"\n",(0,a.jsxs)(n.ol,{start:"4",children:["\n",(0,a.jsx)(n.li,{children:"\u663e\u5f0f\u6027\u548c\u53ef\u9884\u6d4b\u6027"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u901a\u8fc7 .value \u8bbf\u95ee\u5f3a\u5236\u5f00\u53d1\u8005\u663e\u5f0f\u5730\u5904\u7406\u54cd\u5e94\u5f0f\u5f15\u7528\uff0c\u8fd9\u589e\u52a0\u4e86\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u6e05\u695a\u5730\u770b\u5230\u54ea\u4e9b\u53d8\u91cf\u662f\u54cd\u5e94\u5f0f\u7684\uff0c\u5e76\u4e14\u9700\u8981\u901a\u8fc7 .value \u8fdb\u884c\u8bbf\u95ee\u6216\u4fee\u6539\uff0c\u8fd9\u79cd\u663e\u5f0f\u6027\u6709\u52a9\u4e8e\u9632\u6b62\u9519\u8bef\u7684\u4f7f\u7528\uff0c\u5e76\u4f7f\u5f97\u4ee3\u7801\u7684\u610f\u56fe\u66f4\u52a0\u660e\u786e\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"ref-\u4e0e-reactive-\u7684\u533a\u522b",children:"ref \u4e0e reactive \u7684\u533a\u522b"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["ref \u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u5355\u4e2a\u503c\u7684\u54cd\u5e94\u5f0f\u5f15\u7528\u3002\u5b83\u53ef\u4ee5\u7528\u4e8e\u57fa\u672c\u7c7b\u578b\u503c\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5bf9\u8c61\u3002\u5bf9\u4e8e\u57fa\u672c\u7c7b\u578b\u503c\uff0cref \u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u6cd5\u6765\u4f7f\u5b83\u4eec\u53d8\u5f97\u54cd\u5e94\u5f0f\u3002","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u9002\u7528\u573a\u666f\uff1aref \u9002\u5408\u7ba1\u7406\u5355\u4e00\u7684\u6570\u636e\u9879\uff0c\u7279\u522b\u662f\u57fa\u672c\u7c7b\u578b\u7684\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5bf9\u8c61\u548c\u6570\u7ec4\uff0c\u4f46\u5bf9\u4e8e\u590d\u6742\u7684\u5d4c\u5957\u5bf9\u8c61\uff0creactive \u53ef\u80fd\u662f\u66f4\u597d\u7684\u9009\u62e9\u3002"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["reactive \u7528\u4e8e\u521b\u5efa\u54cd\u5e94\u5f0f\u7684\u5bf9\u8c61\u6216\u6570\u7ec4\u3002\u5b83\u76f4\u63a5\u63a5\u53d7\u4e00\u4e2a\u5bf9\u8c61\u6216\u6570\u7ec4\u5e76\u8fd4\u56de\u5176\u54cd\u5e94\u5f0f\u4ee3\u7406\u3002","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u4e0d\u9002\u7528\u4e8e\u57fa\u672c\u7c7b\u578b\uff1areactive \u4e0d\u80fd\u76f4\u63a5\u7528\u4e8e\u57fa\u672c\u7c7b\u578b\u6570\u636e\u3002\u5c1d\u8bd5\u5bf9\u57fa\u672c\u7c7b\u578b\u4f7f\u7528 reactive \u5c06\u4e0d\u4f1a\u4f7f\u5176\u53d8\u4e3a\u54cd\u5e94\u5f0f\u3002"}),"\n",(0,a.jsx)(n.li,{children:"\u9002\u7528\u573a\u666f\uff1areactive \u9002\u5408\u7528\u4e8e\u5bf9\u8c61\u548c\u6570\u7ec4\u7684\u54cd\u5e94\u5f0f\u8f6c\u6362\uff0c\u7279\u522b\u662f\u9700\u8981\u7ba1\u7406\u591a\u4e2a\u76f8\u5173\u6570\u636e\u6216\u5d4c\u5957\u6570\u636e\u65f6\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"import { ref, reactive } from 'vue';\n\n// \u4f7f\u7528 ref\nconst count = ref(0); // \u57fa\u672c\u7c7b\u578b\nconst userProfile = ref({ name: 'John Doe', age: 30 }); // \u5bf9\u8c61\n\n// \u4f7f\u7528 reactive\nconst userState = reactive({ name: 'John Doe', age: 30, likes: ['reading', 'hiking'] }); // \u5bf9\u8c61\n\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u6e90\u7801\u793a\u4f8b",children:"\u6e90\u7801\u793a\u4f8b"}),"\n",(0,a.jsxs)(n.p,{children:["\u6e90\u7801\u5730\u5740: ",(0,a.jsx)(n.a,{href:"https://github.com/vuejs/core/blob/main/packages/reactivity/src/ref.ts#L152",children:"https://github.com/vuejs/core/blob/main/packages/reactivity/src/ref.ts#L152"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"\n\nfunction createRef(rawValue: unknown, shallow: boolean) {\n  if (isRef(rawValue)) {\n    return rawValue\n  }\n  return new RefImpl(rawValue, shallow)\n}\n\nexport const toReactive = <T extends unknown>(value: T): T =>\n  isObject(value) ? reactive(value) : value\n\nclass RefImpl<T> {\n  private _value: T\n  private _rawValue: T\n\n  public dep?: Dep = undefined\n  public readonly __v_isRef = true\n\n  constructor(\n    value: T,\n    public readonly __v_isShallow: boolean,\n  ) {\n    this._rawValue = __v_isShallow ? value : toRaw(value)\n    this._value = __v_isShallow ? value : toReactive(value)\n  }\n\n  get value() {\n    trackRefValue(this)\n    return this._value\n  }\n\n  set value(newVal) {\n    const useDirectValue =\n      this.__v_isShallow || isShallow(newVal) || isReadonly(newVal)\n    newVal = useDirectValue ? newVal : toRaw(newVal)\n    if (hasChanged(newVal, this._rawValue)) {\n      this._rawValue = newVal\n      this._value = useDirectValue ? newVal : toReactive(newVal)\n      triggerRefValue(this, DirtyLevels.Dirty, newVal)\n    }\n  }\n}\n\n/**\n * Force trigger effects that depends on a shallow ref. This is typically used\n * after making deep mutations to the inner value of a shallow ref.\n *\n * @example\n * ```js\n * const shallow = shallowRef({\n *   greet: 'Hello, world'\n * })\n *\n * // Logs \"Hello, world\" once for the first run-through\n * watchEffect(() => {\n *   console.log(shallow.value.greet)\n * })\n *\n * // This won't trigger the effect because the ref is shallow\n * shallow.value.greet = 'Hello, universe'\n *\n * // Logs \"Hello, universe\"\n * triggerRef(shallow)\n * ```\n *\n * @param ref - The ref whose tied effects shall be executed.\n * @see {@link https://vuejs.org/api/reactivity-advanced.html#triggerref}\n */\nexport function triggerRef(ref: Ref) {\n  triggerRefValue(ref, DirtyLevels.Dirty, __DEV__ ? ref.value : void 0)\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>s});var l=r(6540);const a={},t=l.createContext(a);function i(e){const n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);